---
title: "Introducción"
format: 
  html:
    linkcolor: "#1db954"
    toc: true
    toc-location: left
    fig-cap-location: top
    
lang: es
editor: visual
---

## Introducción

La música ha sido parte fundamental de la historia de la humanidad. "La música es una de las expresiones creativas más íntimas del ser, ya que forma parte del quehacer cotidiano de cualquier grupo humano tanto por su goce estético como por su carácter funcional y social. La música nos identifica como seres, como grupos y como cultura, tanto por las raíces identitarias como por la locación geográfica y épocas históricas." (Angel, Camus y Mansilla, 2008: 18).

Desde que la existe la industria musical se han tratado de crear canciones que generen gran impacto en la sociedad, pues esto se podría traducir en beneficios monetarios en un periodo de tiempo cercano al estreno de la canción. Por esto puede ser importante para alguna empresa discográfica saber cómo hacer alguna canción exitosa, por lo tanto, podría ser relevante para estas compañías conocer cuales son las tendencias musicales, y los patrones que se repiten en las canciones que ya fueron exitosas.

Para entender mejor como han sido las tendencias musicales de los últimos años haremos un análisis de una base de datos de "Spotify", con el fin de ver cuales son los factores que hacen que una canción sea popular, o que al menos aumentan las posibilidades de que lo sea.

En este informe tendremos cuatro secciones. La primera parte será para explicar cómo están clasificados los datos, y cuando fueron recolectados, pues la plataforma tiene canciones muy antiguas, mucho más que la plataforma de donde fueron sacados los datos. En la segunda parte dejaremos claro cuáles serán los métodos que usaremos para hacer en análisis. En la tercera parte haremos el análisis y mostraremos los resultados, a través de tablas y gráficos, enfocándonos principalmente en las reproducciones y su relación con las demás variables. Para finalizar, la cuarta parte será una conclusión, en la que clarificaremos cuales son las variables que más influyen en el posible éxito de una canción.

## Contexto

La mayoria de las variables numéricas que miden aspectos tecnicos de una canción se obtuvieron por medio de algoritmos fueron hechos para medir este tipo de información.

La variable `explicit` en "Spotify" se aplica a una canción que tiene:

-   Lenguaje fuerte

-   Imagenes(Portada) o referencias a violencia fisica o mental

-   Referencias o imagenes sexuales

-   Racismo, homofobia, misoginia o cualquier mensaje o comportamiento que se pueda considerar discriminatorio

-   Comportamiento peligroso o criminal que podria incluso ser "glamorizado" o incentivar la imitación de dichas conductas

Generalmente esta variable con fines de restricción parental.

La variable `loudness`, hace referencia a un resuldato del proceso de mezcla de una canción, ya que durante la producción de una pieza musical, las diferentes voces son grabadas con un volumen natural y luego se suele bajar la intensidad del sonido para destacar algunas cosas sobre otras, por eso este aspecto toma valores negativos.

## Datos

Los datos corresponden a una base de datos de Spotify y fueron recogidos durante el mes de noviembre del año 2020. Las variables que se encuentran en esta base de datos se presentan en la siguiente tabla:

```{r echo=FALSE, include=FALSE}
#| fig-cap: "Tabla de variables"
#| label: fig-tabla-variables


```

| Variable           | Tipo     | Descripción                                                                                                                                            |
|------------------|------------------|-------------------------------------|
| `name`             | caracter | Nombre de la canción                                                                                                                                   |
| `id`               | caracter | ID de la canción en Spotify                                                                                                                            |
| `artists`          | caracter | Nombre del/los interpretes                                                                                                                             |
| `year`             | numérica | Año de lanzamiento                                                                                                                                     |
| `release_date`     | caracter | Fecha de lanzamientos (Año-Mes-Día)                                                                                                                    |
| `valence`          | numérica | Qué tipo de emociónes transmite la canción, más triste cerca de 0, más feliz cerca de 1                                                                |
| `acousticness`     | numérica | Qué tan acustico es el sonido de la canción (precencia de instrumentos no electricos ni digitales), mas acústico cerca de 1, menos acústico cerca de 0 |
| `danceability`     | numérica | Que tan bailable es una canción, más bailable cerca de 1, menos bailable cerca de 0                                                                    |
| `duration_ms`      | numérica | Duración en milisegundos                                                                                                                               |
| `energy`           | numérica | Intencidad perceptual de la canción                                                                                                                    |
| `explicit`         | numérica | La canción tiene contenido explicito (Si=1,No=0)                                                                                                       |
| `instrumentalness` | numérica | Cantidad de voces en la canción, más cerca está de 1.0, más instrumental, tambien puede referenciar la complejidad de la obra                          |
| `key`              | numérica | Tono de la canción                                                                                                                                     |
| `liveness`         | numérica | Probabilidad de que la canción haya sido grabada en vivo                                                                                               |
| `loudness`         | numérica | Volumen de la canción                                                                                                                                  |
| `mode`             | numérica | Tonalidad mayor si es 1, tonalidad menor si es 0                                                                                                       |
| `popularity`       | numérica | Qué tan popular es la canción                                                                                                                          |
| `speechiness`      | numérica | Proporción de tiempo que ocupan palabras habladas o cantadas en la canción                                                                             |
| `tempo`            | numérica | Tempo de la canción (velocidad)                                                                                                                        |

Para trabajar usaremos aquellas variables que reflejen cierta tendencia, para hacer este análisis trabajaremos con la base de datos `data`, qué es la que contiene todos los datos, junto con la base `data_by_year` que contiene todas las variables numéricas pero se promedian por año, trabajaremos un poco con la variable `explicit` de la base de datos `data`, para contar cuantas canciones con contenido explicito hay cada año. Ademas se ajustara un modelo de regresión, para ver cuales aspectos inciden más en la popularidad de la canción, los cálculos necesarios para este llegar a este modelo se haran con una muestra que fue seleccionada bajo un criterio de popularidad, esta base de datos fue nombrada `datos_a_estudiar1`, luego hicimos una muestra aleatoria de la base da datos `data` llamada muestra_datos, de igual tamaño que `datos_a_estudiar1`, lo que motiva la creación de esta muestra es hacer una comparación entre el comportamiento de las canciones populares y el resto de canciones, pero la base de datos completa es muy grande y puede ser poco eficiente computacionalmente trabajar con tantos datos.

Tambien se añadieron seis variables a las bases de datos a estudiar, que se presentan en la siguiente tabla:

| Variable           | Tipo     | Descripcion                                                  |
|--------------------|----------|--------------------------------------------------------------|
| Popularidad        | caracter | La canción cumple con el requisito para considerarse popular |
| artist_list        | lista    | Lista de interpretes                                         |
| numero_de_artistas | numérica | Número de interpretes                                        |
| main_artist        | caracter | Interprete principal de la canción                           |
| duration_s         | numérica | Duración en segundos de la canción                           |
| feat               | numérica | Si es una colaboración es 1, si no es 0                      |

A pesar de que se crearon variables que podrian reemplazar como `duration_ms` y `artist` por `duration_s` y `artist_list` no se elimino ninguna variable original.

## Resultados

```{r echo=FALSE, include=FALSE}
library(readr)
library(dplyr)
library(ggplot2)
library(here)
library(gt)
library(gtsummary)
library(gridExtra)



datos=read_csv(here::here("datos/data.csv"))

datos_por_año=read_csv(here::here("datos/data_by_year.csv"))

datos_a_estudiar1=read_csv(here::here("datos/datos_a_estudiar1.csv"))

muestra_datos=read_csv(here::here("datos/muestra_datos.csv"))


cantft=read_csv(here::here("datos/feat.csv"))

cantftM=read_csv(here::here("datos/featM.csv"))

datosye=data.frame(datos$year,datos$explicit)


datosye=tapply(datos$explicit,datos$year,FUN = sum)

datosye2=data.frame(seq(1921,2020),datosye)


```

```{r echo=FALSE}
#| fig-cap: "Bailabilidad promedio por año"
#| label: fig-baiporaño


grafby=datos_por_año %>% 
  ggplot(aes(year,danceability))+
  geom_line(size=2,col="#1db954")+
  theme_bw()+
  labs(
       x="Año",
       y="Bailabilidad")
grafby
```

Se ve que ha habido un incremento de la bailabilidad, mucho mayor que mas o menos del

```{r echo=FALSE}
#| fig-cap: "Canciones explicitas por año"
#| label: fig-expporaño



grafico2=datosye2 %>% 
  ggplot(aes(seq.1921..2020.,datosye))+
  geom_line(size=2,col="#1db954" )+
  theme_bw()+
  labs(
       x="Año",
       y="Cantidad de canciones")
grafico2
```

```{r echo=FALSE}
#| fig-cap: "Acusticidad promedio por año"
#| label: fig-acporaño


grafacy=datos_por_año %>% 
  ggplot(aes(year,acousticness))+
  geom_line(size=2,col="#1db954")+
  theme_bw()+
  geom_vline(xintercept = 1951.5,linetype="dashed",color="black")+
  labs(
    x="Año",
    y="Acusticidad(Naturalidad del sonido)")+
  annotate("text", x = 1970, y = 0.95, label = "Creación primer sintetizador de música")
grafacy
```

```{r echo=FALSE}
#| fig-cap: "Instrumentalidad promedio por año"
#| label: fig-intporaño

grafinty=datos_por_año %>% 
  ggplot(aes(year,instrumentalness))+
  geom_line(size=2,col="#1db954")+
  theme_bw()+
  labs(
    x="Año",
    y="Instrumentalidad")
grafinty
```

```{r echo=FALSE}
#| fig-cap: "Energia promedio por año"
#| label: fig-engporaño


grafeny=datos_por_año %>% 
  ggplot(aes(year,energy))+
  geom_line(size=2,col="#1db954")+
  theme_bw()+
  labs(
    x="Año",
    y="Energía")

grafeny
```

Es evidente que hay canciones que no sirven, en primera instancia, para el estudio que queremos hacer, por lo tanto, si queremos maximizar las probabilidades de que el producto sea exitoso debemos ver cuales son los que han llegado al resultado que estamos buscando, para ello veamos la Figura 2:

```{r echo=FALSE}
#| fig-cap: "Canciones populares y no populares"
#| label: fig-subconj

datos$Popularidad=ifelse(datos$popularity >76, "Popular","No Popular")
grafico1=ggplot(data = datos)+
  geom_histogram(aes(x=datos$popularity, fill=Popularidad),bins = 30)+
  labs(
       x="Popularidad", y="Número de Canciones")+
  scale_fill_manual(values = c("#b3b3b3", "#1db954"))+
  theme_bw()+
  geom_vline(xintercept = 76,linetype="dashed",color="black")+
  annotate("text", x = 87, y = 25000, label = "Canciones a estudiar")
grafico1
```

Vemos que si el requisito mínimo para considerar una canción exitosa, es que tenga un valor sobre 75 en el indice de popularidad, y a simple vista se ve que la cantidad de obras que llegan a este número son muy pocas y que de hecho la mayoria de las canciones, se quedan cerca del 0.

decir que es el equivalente al 1% de los artistas, que según un diario se llego a que este es el porcentaje de interpretes que se lleva la mayor proporcion de las ganancias en la industrial musical, en base a este dato, se decidio buscar en qué valor de la variable `popularity` estaba el percentil 99, se encontro que el 1% corresponde a un 76 en la variable antes mencionada.

Con la idea de ver cuales son las variables qué más influyen en la popularidad de una canción se ajustó un modelo de regresión lineal (anexo), a partir del cual se llego a que los aspectos que más afectan a la popularidad de una canción son, en orden descendente, la duranción, la bailabilidad, la instrumentalidad, la energia, el volumen y el número de interpretes.

Por lo tanto, vamos a ver como se comportan las variables asociadas a los aspectos antes mencionados, en el 1% más popular y lo compararemos con una muestra aleatoria de igual tamaño de la base de datos completa, para ver cuales son las diferencias entre las canciones más populares y el resto de estas.

## Resultados

En este apartado todos los gráficos de color verde corresponden al aquellas canciones que tiene un 76 o más en el indice de popularidad, las grises son aquellas que pertenecen a la muestra de la base de datos completa.

Como se dijo, respecto al modelo de regresión, el aspecto más relevante es la duración de la canción, entonces, veamos como se concentran en la Figura #:

```{r echo=FALSE}
#| fig-cap: "Duranción en segundos de canciones populares y muestra de las otras canciones"
#| label: fig-canciones-pop-durs

grafico4=ggplot(data=datos_a_estudiar1)+
  geom_histogram(aes(x=duration_s),col= "black",fill="#1db954",bins = 30)+
  theme_bw()+
  labs(x="Duración",
       y="Cantidad de canciones")

  
grafico42=ggplot(data=muestra_datos)+
  geom_histogram(aes(x=duration_s),col= "black",fill="#b3b3b3",bins = 30)+
  theme_bw()+
  labs(x="Duración",
       y="Cantidad de canciones")
  

graf4=grid.arrange(grafico4,grafico42,ncol=2)

```

Vemos que las canciones mas populares concentran su duranción en torno a los 200 segundos, unos 3 minutos y medio, pero suelen alejarce de manera mas "controlada", en cambio a nivel general, a pesar de la duración esta concentrada practicamente en el mismo rango de segundos, llegando incluso a que la proporción de canciones que duran casi lo mismo es más o menos el doble, la duración de las canciones se va de manera mas agresiva hacia los extremos, de hecho hay varias piezas que se acercan a la media hora de duración.

La siguiente variable es la bailabilidad, que como vimos antes ha ido en incremento---

```{r echo=FALSE}
#| fig-cap: "Bailabilidad de canciones populares y muestra de las otras canciones"
#| label: fig-canciones-pop-dance

grafico5=ggplot(data=datos_a_estudiar1)+
  geom_histogram(aes(x=danceability),col= "black",fill="#1db954",bins = 30)+
  theme_bw()+
  labs(
       x="Bailabilidad",
       y="Cantidad de canciones")



grafico52=ggplot(data=muestra_datos)+
  geom_histogram(aes(x=danceability),col= "black",fill="#b3b3b3",bins = 30)+
  theme_bw()+
  labs(
       x="Bailabilidad",
       y="Cantidad de canciones")

grid.arrange(grafico5,grafico52,ncol=2)

```

La distribución es casi la misma, tal vez hay una leve inclinación hacia el 1, maýor bailabilidad, en las canciones mas populares, junto con esto, tambien podemos ver que casi no hay canciones con menos de un 0.25, pero ademas de eso, las diferencias son practicamente inexistente.

```{r echo=FALSE}
#| fig-cap: "Instrumentalidad de canciones populares y muestra de las otras canciones"
#| label: fig-canciones-pop-inst



grafico6=ggplot(data=datos_a_estudiar1)+
  geom_histogram(aes(x=instrumentalness), col= "black",fill="#1db954", bins=30)+
  theme_bw()+
  labs(
       x="Instrumentalidad",
       y="Cantidad de canciones")



grafico62=ggplot(data=muestra_datos)+
  geom_histogram(aes(x=instrumentalness),col= "black",fill="#b3b3b3", bins=30)+
  theme_bw()+
  labs(
       x="Instrumentalidad",
       y="Cantidad de canciones")

grid.arrange(grafico6,grafico62,ncol=2)

```

Nuevamente vemos una diferencia minima,

```{r echo=FALSE}
#| fig-cap: "Energia de canciones populares y muestra de las otras canciones"
#| label: fig-canciones-pop-energy


grafico7=ggplot(data=datos_a_estudiar1)+
  geom_histogram(aes(x=energy),col= "black",fill="#1db954", bins=30)+
  theme_bw()+
  labs(
       x="Energia",
       y="Cantidad de canciones")



grafico72=ggplot(data=muestra_datos)+
  geom_histogram(aes(x=energy),col= "black",fill="#b3b3b3", bins=30)+
  theme_bw()+  
  labs(
                    x="Energia",
                    y="Cantidad de canciones")


grid.arrange(grafico7,grafico72,ncol=2)
```

```{r echo=FALSE}
#| fig-cap: "Volumen de canciones populares y muestra de las otras canciones"
#| label: fig-canciones-pop-loud


grafico8=ggplot(data=datos_a_estudiar1)+
  geom_histogram(aes(x=loudness),col= "black",fill="#1db954", bins=30)+
  theme_bw()+
  labs(
       x="volumen",
       y="Cantidad de canciones")

grafico82=ggplot(data=muestra_datos)+
  geom_histogram(aes(x=loudness),col= "black",fill="#b3b3b3", bins=30)+
  theme_bw()+
  labs(
       x="Volumen",
       y="Cantidad de canciones")

grid.arrange(grafico8,grafico82,ncol=2)

```

```{r echo=FALSE}
#| fig-cap: "Volumen de canciones populares y muestra de las otras canciones"
#| label: fig-canciones-pop-Numart


grafico9=ggplot(data=datos_a_estudiar1)+
  geom_histogram(aes(x=numero_de_artistas),col= "black",fill="#1db954", bins=30)+
  theme_bw()+
  labs(
       x="Numero de artistas",
       y="Cantidad de canciones")



grafico92=ggplot(data=muestra_datos)+
  geom_histogram(aes(x=numero_de_artista_muestra),col= "black",fill="#b3b3b3", bins=30)+
  theme_bw()+
  labs(
       x="Numero de artistas",
       y="Cantidad de canciones")

grid.arrange(grafico9,grafico92,ncol=2)

```

```{r echo=FALSE}
#| fig-cap: "Colaboraciones en canciones populares y muestra de las otras canciones"
#| label: fig-canciones-pop-feat




grafico10=ggplot(data=cantft,aes(x=name,y=value))+
  geom_bar(stat="identity" ,col= "black",fill="#1db954",width=0.5)+
  theme_bw()+
  labs(x="Tipo de canción",
       y="Cantidad de canciones")




grafico102=ggplot(data=cantftM,aes(x=name,y=value))+
  geom_bar(stat="identity" ,col= "black",fill="#b3b3b3",width=0.5)+
  theme_bw()+
  labs(x="Tipo de canción",
       y="Cantidad de canciones")

grid.arrange(grafico10,grafico102,ncol=2)
```
